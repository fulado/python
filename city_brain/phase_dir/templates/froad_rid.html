<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>电科进口道与rid对应关系</title>
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css">
    <script type="text/javascript" src="/static/js/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="/static/js/bootstrap.min.js"></script>

    <style type="text/css">
        .cust_dir {
            position: absolute;
            left: 100px;
            top: 0px;
        }

        .rid_dir {
            position: absolute;
            left: 600px;
            top: 0px;
        }

        .result {
            position: absolute;
            left: 200px;
            top: 500px;
            width: 900px;
        }

    </style>
</head>
<body>

    <div class="cust_dir">
        <svg width="600px" height="600px" version="1.1" xmlns="http://www.w3.org/2000/svg">
            {% for cust_froad_info in cust_froad_list %}
             <a href="#" data-toggle="modal" data-target="#myModal" onclick="setFroad('{{ cust_froad_info.id }}')">
                <g stroke="gray" stroke-width="20">
                    <path d="M300 300 200 300" transform="rotate({{ cust_froad_info.cust_froad_angle }}, 300, 300)"/>
                <text x="250" y="150" style="stroke-width: 0.1;font-size: 15px;" transform="rotate({{ cust_froad_info.cust_froad_angle|add:-90 }}, 300, 300)">
                    {{ cust_froad_info.cust_froad_id }} - {{ cust_froad_info.cust_froad_angle }} - {{cust_froad_info.cust_froad_name}}
                </text>
                </g>
             </a>
            {% endfor %}}
        </svg>
    </div>

    <div class="rid_dir">
        <svg width="600px" height="600px" version="1.1" xmlns="http://www.w3.org/2000/svg">
            <g stroke="gray" stroke-width="20">
                {% for rid_info in rid_list %}
                <path d="M300 300 300 200" transform="rotate({{ rid_info.ft_angle }}, 300, 300)"/>
                <text x="250" y="150" style="stroke-width: 0.1;font-size: 15px;" transform="rotate({{ rid_info.ft_angle }}, 300, 300)">
                    {{ rid_info.ft_angle }} - {{ rid_info.rid_name }}
                </text>
                {% endfor %}}
            </g>
        </svg>
    </div>

    <!--匹配结果-->
    <div class="result">
        <table class="table table-striped table-hover text-center">
            <thead>
            <tr>
                <td>电路进口道</td>
                <td>rid</td>
                <td>操作</td>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>1</td>
                <td>2</td>
                <td><a href="#">
                    <button class="btn btn-default">删除</button>
                </a></td>
            </tr>
            <tr>
                <td>1</td>
                <td>2</td>
                <td><a href="#">
                    <button class="btn btn-default">删除</button>
                </a></td>
            </tr>
            <tr>
                <td>1</td>
                <td>2</td>
                <td><a href="#">
                    <button class="btn btn-default">删除</button>
                </a></td>
            </tr>
            <tr>
                <td>1</td>
                <td>2</td>
                <td><a href="#">
                    <button class="btn btn-default">删除</button>
                </a></td>
            </tr>
            </tbody>
        </table>
    </div>

    <!--模态框-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">进口道对应关系</h4>
                </div>
                <div class="modal-body">
                    <label>电科进口道</label>
                    <select>
                        {% for cust_froad_info in cust_froad_list %}
                        <option value="{{ cust_froad_info.id }}">{{ cust_froad_info.cust_froad_id }} - {{ cust_froad_info.cust_froad_angle }} - {{cust_froad_info.cust_froad_name}}</option>
                        {% endfor %}
                    </select>

                    <label>rid</label>
                    <select>
                        {% for rid_info in rid_list %}
                        <option>{{ rid_info.ft_angle }} - {{ rid_info.rid_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary">提交更改</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
</body>
<script type="text/javascript">

    // 设置模态框中的电科进口道
    function setFroad(road_id) {
        $(".modal-body select").eq(0).val(road_id);
    }

    // 添加对应关系
    function addStation(road_id, rid_id) {
        // 添加站点
        //$.get('/station_add', {'station_id': station_id, 'route_name': route_name}, function (data) {
        let result;
        result = addStationToForm(station_id);

        if (result == 0) {
            let station_name = '';
            let station_area = '';
            let station_road = '';
            let station_direction = '';
            $.get('/get_station_info', {'station_id': station_id}, function (data) {
                station_name = data.station_name;
                station_area = data.station_area;
                station_road = data.station_road;
                station_direction = data.station_direction;
            });

            let newRow = "<tr style=\"height: 40px;\">\n" +
                            "<td style=\"width: 4%\">" + "</td>\n" +
                            "<td title=" + station_name + ">" + station_name + "</td>\n" +
                            "<td title=" + station_area + ">" + station_area + "</td>\n" +
                            "<td title=" + station_road + ">" + station_road + "</td>\n" +
                            "<td title=" + station_direction + ">" + station_direction + "</td>\n" +
                            "<td>\n" +
                            "<button type=\"button\" class=\"see modify-vehicle-info\" style=\"margin-right: 5px;\" route_id=\"" + station_id + "\">删除</button>\n" +
                            "</td>\n" +
                            "<input type=\"hidden\" value=" + station_id + ">"
                        "</tr>"
            $('.add-station tr:last').after(newRow);
            refreshRowNumber();
            refreshStationList();
        } else if (result == 3) {
            alert('该站点已停满，请选择其它站点');
        } else if (result == 2) {
            alert('站点已经存在于路线中');
        } else if (result == 1) {
            alert('站点数量不能超过5个');
        } else {
            alert('添加站点失败');
        }
        //})
    }

</script>
</html>