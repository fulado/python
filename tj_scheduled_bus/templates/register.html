<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <!-- 目前仅限360急速浏览 webkit:急速  ie-comp:ie兼容模式   ie-stand: ie标准模式 -->
    <meta name="renderer" content="webkit">
    <link rel="stylesheet" href="/static/css/initial.css"/>
    <link rel="stylesheet" href="/static/css/header.css"/>
    <link rel="stylesheet" href="/static/css/login.css"/>
    <link rel="stylesheet" href="/static/css/company.css"/>
    {% if cp == '0' %}
    <title>注册</title>
    {% else %}
    <title>修改密码</title>
    {% endif %}
    <style type="text/css">
        .announce{
            background-color: #ffffff;
            position: fixed;
			left: 50%;
			top: 50%;
            width: 600px;
            height: 320px;
            z-index:9999;
            margin-left: -322px;
            margin-top: -250px;
            padding: 20px;
            border: 2px solid #E3E3E3;
            border-radius: 10px;
        }

        .announce h1{
            font-size: 40px;
            color: red;
            text-align: center;
            margin: 20px;
        }
        .announce p{
            font-size: 25px;
            line-height: 40px;
        }

        .announce div{
            text-align: center;
        }
        .btn{
            width: 120px;
            height: 45px;
            border-radius: 10px;
            font: 25px Microsoft YaHei;
            outline: none;
            cursor: pointer;
            text-align: center;
            line-height: 45px;
            margin-top: 20px;
        }

        .announce .time{
            font-size: 16px;
        }
    </style>
</head>
<body>
<div class="body_back"></div>
<div class="header">
    <div class="logo">
        <span class="logo_icon"></span>
    </div>
    <div class="text_wrapper">
        <span class="text_icon_1">天津交管局</span>
        <span class="text_icon_2">班车通行证管理系统</span>
    </div>
</div>
<div class="form_wrapper" style="height: 710px; width: 535px;">
    {% if cp == '0' %}
    <form action="/register_handle" method="post" id="form_box">
    {% else %}
    <form action="/change_password" method="post" id="form_box">
    {% endif %}
        {% csrf_token %}
        <div class="login_btn"><a href="/login">用户登录</a></div>
        <div class="login_btn" style="left: 183px;"><a href="/register?cp=0" {% if cp == '0' %}style="color: white;"{% endif %}>用户注册</a></div>
        <div class="login_btn" style="left: 351px;"><a href="/register?cp=1" {% if cp == '1' %}style="color: white;"{% endif %}>找回密码</a></div>
        <div class="form_group">
            <span class="word">账号</span>
            <input type="text" placeholder="输入账号" id="username" name="username" class=""/>
        </div>
        <div class="form_group">
            <span class="word">{% if cp == '1' %}新{% endif %}密码</span>
            <input type="password" placeholder="输入{% if cp == '1' %}新{% endif %}密码" id="psw" name="password"/>
        </div>
        <div class="form_group">
            <span class="word">确认密码</span>
            <input type="password" placeholder="输入密码" id="re_psw" name="re_password"/>
        </div>
        <div class="form_group">
            <span class="word">手机号</span>
            <input type="text" placeholder="输入{% if cp == '1' %}注册的{% endif %}手机号" id="phone" name="phone"/>
        </div>
        <div class="form_group check-code">
            <span class="word">手机验证码</span>
            <input type="text" placeholder="输入验证码" id="yz" class="yz" name="sms_code" style="width: 110px!important;"/>
            <div class="YZ_img">
                <button style="width: 100%; height: 100%;" id="second">点击获取验证码</button>
            </div>
        </div>
{#        <div class="form_group">#}
{#            <span class="word">验证码</span>#}
{#            <input type="text" placeholder="输入验证码" id="yz" class="yz" name="check_code" style="width: 136px!important;"/>#}
{#            <div class="YZ_img">#}
{#                <img src="/check_code" alt="" width="100%" height="100%"/>#}
{#            </div>#}
{#        </div>#}
        {% if cp == '0' %}
        <div class="login_button" id="login_button">注册</div>
        {% else %}
        <div class="login_button" id="login_button">修改密码</div>
        {% endif %}
        <!--<div class="login_button link_button" id="link_button">直接查询</div>-->
        <!-- <div class="login_button operation" id="operation">申请流程下载</div> -->
    </form>
    <p style="font-size: 20px; text-align: center; margin-top: 10px;">{{ msg }}</p>
</div>


</body>
<script src="/static/js/jquery-1.8.3.min.js"></script>
<!--<script src="/static/js/login.js"></script>-->
<script src="/static/js/md5.js"></script>
<script type="text/javascript">

    $('#login_button').click(function() {
        var type;
        for(var i = 0 ; i <$('#form_box input').length;i++){
            if(!Boolean($('#form_box input').eq(i).val().trim())){
                type = false;
            }
        }
        if(type == false){
            alert('请检查内容是否输入完整')
        }else{
            $('#form_box').submit();
        }
    });

    $("#second").click(function () {
        sendyzm($("#second"));
    });

    //用ajax提交到后台的发送短信接口
    function sendyzm(obj) {
        var phone = $("#phone").val();
        var result = isPhoneNum();
        if (result) {
            $.ajax({
                url: "/sms_check_code",
                data: {'phone': phone},
                dataType: "json",
                type: "post",
                async: false,
                cache: false,
                success: function (data) {
                    // debugger;
                    if (data.result) {
                        alert("验证码发送成功");
                    } else {
                        alert("验证码发送失败");
                    }
                },
                error: function () {
                    alert("验证码发送失败");
                }
            })
            setTime(obj);//开始倒计时
        }
    }

    //60s倒计时实现逻辑
    var countdown = 60;
    function setTime(obj) {
        if (countdown == 0) {
            obj.prop('disabled', false);
            obj.text("点击获取验证码");
            countdown = 60;//60秒过后button上的文字初始化,计时器初始化;
            return;
        } else {
            obj.prop('disabled', true);
            obj.text("("+countdown+"s)后重新发送") ;
            countdown--;
        }
        setTimeout(function() { setTime(obj) },1000) //每1000毫秒执行一次
    }

    //校验手机号是否合法
    function isPhoneNum() {
        var phonenum = $("#phone").val();
        var reg = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
        if(!reg.test(phonenum)){
            alert('请输入有效的手机号码！');
            return false;
        }else{
            return true;
        }
    }

</script>
</html>